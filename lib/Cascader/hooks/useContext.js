"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue");require("../../node_modules/tinycolor2/esm/tinycolor.js"),require("../../_shared/utils/dom.js");const l=require("../../_shared/utils/is.js");require("../../_shared/utils/time.js"),require("../../Empty/index.js"),require("../../_shared/icons/_Icon.vue.js");const a=require("../../_shared/utils/control.js"),r="cascader-context",t=(e,l=1,a=[])=>e.map(((e,r)=>{const n={...e,index:r,level:l},i=[...a,n],o={...n,nodePath:i};return o.children&&o.children.length>0&&(o.children=t(o.children,l+1,i)),o})),n=e=>{const l=[],a=e=>{e.forEach((e=>{l.push(e),e.children&&e.children.length>0&&a(e.children)}))};return a(e),l};function i(e,l){return e.map((e=>{const a={};return a.label=e[l.label]??e.label,a.value=e[l.value]??e.value,l.render&&(a.render=e[l.render]??e.render),l.disabled&&(a.disabled=e[l.disabled]??e.disabled),l.tagProps&&(a.tagProps=e[l.tagProps]??e.tagProps),l.isLeaf&&(a.isLeaf=e[l.isLeaf]??e.isLeaf),l.children&&e[l.children]?a.children=i(e[l.children],l):e.children&&(a.children=i(e.children,l)),a}))}exports.default=()=>({provide:(o,u,d)=>{const{modelValue:s,defaultValue:p,inputValue:c,defaultInputValue:h,popupVisible:v,defaultPopupVisible:f,pathMode:m,searchDelay:g,multiple:b,disabled:x,allowClear:V,allowSearch:j,loading:O,fieldNames:P,valueKey:L,expandTrigger:y,expandChild:M,searchOptionOnlyLabel:_,options:q}=e.toRefs(o),{formatLabel:E,fallback:w,filterOption:C,loadMore:I}=o,S=a(s,p.value,(e=>{u("update:modelValue",e),u("change",e)})),K=a(c,h.value,(e=>{u("update:inputValue",e),u("input-value-change",e)})),T=a(v,f.value,(e=>{u("update:popupVisible",e),u("popup-visible-change",e)})),k=e.ref([...q.value]),A=e.computed((()=>{const e=Object.fromEntries(["label","value","render","disabled","tagProps","children","isLeaf"].map((e=>{var l;return[e,(null==(l=P.value)?void 0:l[e])??e]})));return n(t(i(k.value,e)))})),B=e.computed((()=>Object.fromEntries([...A.value.map((e=>[Q(e.nodePath.map((e=>e.value))),e])),...A.value.map((e=>[Q(e),e]))]))),D=e.computed((()=>A.value.filter((e=>{var l;return!(null==(l=e.children)?void 0:l.length)})))),F=e.computed((()=>D.value.filter((e=>C(K.value,e))).map((e=>{var l;return{...e,label:_.value?e.label:null==(l=e.nodePath)?void 0:l.map((e=>e.label)).join(" / ")}})))),N=e.computed((()=>(b.value?S.value:[S.value].map((e=>e))).map((e=>{var a,r;const t=U(e);return t?{...t,id:null==(a=t.nodePath)?void 0:a.map((e=>e.index)).join("-"),label:(null==E?void 0:E(t.nodePath))??(null==(r=t.nodePath)?void 0:r.map((e=>e.label)).join(" / "))}:l.isBoolean(w)&&w||l.isFunction(w)?{id:Q(e),label:l.isFunction(w)?w(e):Q(e),value:Q(e)}:null})).filter((e=>e)))),R=e.ref(1),z=e.computed((()=>Math.max(...D.value.map((e=>e.level)))||0)),G=e.ref([]),H=e.useSlots(),J=e=>l.isObject(e)?e[L.value]:e,Q=e=>l.isArray(e)?e.map((e=>J(e))).join(" / "):J(e),U=e=>B.value[Q(e)];return e.watch(q,(()=>{k.value=q.value}),{deep:!0}),e.provide(r,{computedValue:S,computedInputValue:K,options:A,totalOptions:k,searchOptions:F,curLevel:R,maxLevel:z,curPath:G,expandTrigger:y,expandChild:M,pathMode:m,multiple:b,loading:O,slots:H,blur:function(){var e;null==(e=d.value)||e.blur()},getValueKey:Q,getOption:U,loadMore:I}),{computedValue:S,computedInputValue:K,computedVisible:T,options:A,optionMap:B,selectOptions:N,curLevel:R,curPath:G,multiple:b,pathMode:m,disabled:x,allowClear:V,allowSearch:j,searchDelay:g,loading:O,getValue:J,getValueKey:Q,getOption:U}},inject:()=>e.inject(r,{computedValue:e.ref(""),computedInputValue:e.ref(""),options:e.ref([]),totalOptions:e.ref([]),searchOptions:e.ref([]),expandTrigger:e.ref("click"),expandChild:e.ref(!1),curLevel:e.ref(1),maxLevel:e.ref(0),curPath:e.ref([]),pathMode:e.ref(!1),multiple:e.ref(!1),loading:e.ref(!1),slots:{},blur:()=>{},getValueKey:()=>"",getOption:()=>({})})}),exports.findOptionByValueAndLevel=function e(l,a,r,t=1){if(!(t>r))for(const n of l){if(t===r&&n.value===a)return n;if(n.children&&n.children.length>0){const l=e(n.children,a,r,t+1);if(l)return l}}},exports.findOptions=(e,l,a)=>1==l?e.filter((e=>e.level==l)):e.filter((e=>{var r;return e.level==l&&(null==(r=e.nodePath)?void 0:r.slice(0,e.nodePath.length-1).map((e=>e.index)).join(""))==a.join("")})),exports.flattenOptions=n,exports.getLeafNodes=e=>{const l=[];function a(e){e.children&&0!==e.children.length?e.children.forEach((e=>a(e))):l.push(e)}return e.forEach((e=>a(e))),l},exports.transformOptions=t;
