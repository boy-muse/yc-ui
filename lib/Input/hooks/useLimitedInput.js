"use strict";const e=require("vue");require("../../node_modules/tinycolor2/esm/tinycolor.js"),require("../../_shared/utils/dom.js");const u=require("../../_shared/utils/is.js");require("../../_shared/utils/time.js"),require("../../Empty/index.js"),require("../../_shared/icons/_Icon.vue.js");const l=require("../../_shared/utils/control.js"),a=require("./useCursor.js");module.exports=r=>{const{props:t,emits:o,inputRef:n}=r,{modelValue:s,defaultValue:i,disabled:v,readonly:d,allowClear:c,error:m,showWordLimit:p,maxLength:h}=e.toRefs(t),{wordLength:g,wordSlice:f}=t,{setCursor:q,recordCursor:y}=a(n),j=e.computed((()=>{var e;return u.isNumber(h.value)?h.value:null==(e=h.value)?void 0:e.length})),w=e.computed((()=>{var e;return!u.isNumber(h.value)&&(null==(e=h.value)?void 0:e.errorOnly)})),_=l(m,!1),x=l(s,i.value,(e=>{o("update:modelValue",e)})),C=e.computed((()=>u.isNumber(j.value)&&p.value)),L=e.computed((()=>c.value&&!v.value&&!d.value&&!!x.value.length));let b=0;const V=e.computed((()=>T(x.value))),N=e.ref(!1);function T(e){return u.isFunction(g)?g(e):(null==e?void 0:e.length)||0}const E=async()=>{y(),await e.nextTick(),n.value&&x.value!==n.value.value&&(n.value.value=x.value,q())},I=(e,u)=>{j.value&&T(e)>j.value?w.value?(x.value=e,_.value=!0):x.value=f(e,b):x.value=e,o("input",e,u),E()};return{computedValue:x,showClearBtn:L,showWordLimit:C,curLength:V,error:_,disabled:v,maxLength:j,handleInput:async e=>{const{value:u}=e.target;if(!N.value){if(V.value==j.value&&(b=x.value.length),j.value&&!w.value&&V.value>=j.value&&T(u)>j.value&&"insertText"===e.inputType)return E();I(u,e)}},handleComposition:e=>{const{value:l,selectionStart:a,selectionEnd:r}=e.target;if(N.value="compositionend"!==e.type,!N.value)return j.value&&!w.value&&V.value>=j.value&&T(l)>j.value&&a===r?E():void I(l,e);u.isUndefined(j.value)&&(o("input",l,e),x.value=l)}}};
