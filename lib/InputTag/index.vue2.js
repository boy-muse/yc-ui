"use strict";const e=require("vue"),l=require("../node_modules/nanoid/index.browser.js"),a=require("../node_modules/@vueuse/core/index.js");require("../node_modules/tinycolor2/esm/tinycolor.js"),require("../_shared/utils/dom.js");const t=require("../_shared/utils/fn.js"),u=require("../_shared/utils/is.js");require("../_shared/utils/time.js");const o=require("../_shared/utils/global-config.js"),r=require("../_shared/utils/control.js"),n=require("../Tag/index.js"),s=require("../_shared/components/IconButton.vue.js"),i=require("../_shared/components/PreventFocus.vue.js");require("../_shared/components/ExpandTransition.vue.js");const d=["disabled","readonly","placeholder"],c=e.defineComponent({name:"InputTag",__name:"index",props:{modelValue:{default:void 0},defaultValue:{default:()=>[]},inputValue:{default:void 0},defaultInputValue:{default:""},placeholder:{default:""},disabled:{type:Boolean,default:!1},error:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!1},size:{default:void 0},maxTagCount:{default:0},retainInputValue:{type:[Boolean,Object],default:!1},formatTag:{},uniqueValue:{type:Boolean,default:!1},tagNowrap:{type:Boolean,default:!1},fieldNames:{default:()=>({id:"id",label:"label",value:"value",closeable:"closeable",tagProps:"tagProps"})},allowCreate:{type:Boolean,default:!0}},emits:["update:modelValue","update:inputValue","input","input-value-change","focus","blur","press-enter","remove","clear"],setup(c,{expose:v,emit:p}){const f=c,m=p,{modelValue:g,defaultValue:b,inputValue:y,defaultInputValue:h,allowClear:k,disabled:x,readonly:w,uniqueValue:V,retainInputValue:B,allowCreate:C,maxTagCount:_,fieldNames:j,tagNowrap:q}=e.toRefs(f),{size:N}=o.getGlobalConfig(f),T=e.ref(),E=e.ref(),P=e.computed((()=>Object.fromEntries(["id","label","value","closable","tagProps"].map((e=>[e,j.value[e]??e]))))),{width:S}=a.useElementSize(E,void 0,{box:"border-box"}),z=r(g,b.value,(e=>m("update:modelValue",e)),(e=>{const{id:a,label:t,value:o,closable:r,tagProps:n}=P.value;return e.map((e=>{if(u.isObject(e)){const t=e;return t[a]=t[a]??l.nanoid(),t[r]=t[r]??!0,t[n]=t[n]??{bordered:!0,nowrap:q.value},e}const s={};return s[a]=l.nanoid(),s[t]=e,s[o]=e,s[r]=!0,s[n]={bordered:!0,nowrap:q.value},s}))})),I=r(y,h.value,(e=>{m("update:inputValue",e)})),$=e.computed((()=>({visibleList:_.value>0?z.value.slice(0,_.value):z.value,hideList:z.value.slice(_.value)}))),D=e.computed((()=>k.value&&!x.value&&!w.value&&z.value.length)),L=()=>{u.isBoolean(B.value)&&B.value||u.isObject(B.value)&&B.value.create||(I.value="")},O=(e,a,t)=>{var u,o;const r=null==(u=I.value)?void 0:u.trim();switch(e){case"input":case"input-value-change":{const{value:l}=a.target;m(e,l,a)}break;case"focus":case"blur":m(e,a),"blur"==e&&L();break;case"pressEnter":{const{label:e,value:t,id:u}=P.value,o=!V.value||V.value&&!z.value.find((e=>((null==e?void 0:e[t])??e)==r));if(!r||!C.value||!o)return;const n={};n[u]=l.nanoid(),n[e]=I.value,n[t]=I.value,z.value=[...z.value,n],m("press-enter",a),L()}break;case"close":{const e=z.value,l=e.find((e=>e.id==t));z.value=e.filter((e=>e.id!=t)),m("remove",null==l?void 0:l.value,a)}break;case"remove":{if(r||!(null==(o=z.value)?void 0:o.length))return;const e=z.value[z.value.length-1];z.value=z.value.slice(0,z.value.length-1),m("remove",e.value,a)}break;case"clear":z.value=[],m("clear",a)}};return v({focus(){var e;null==(e=T.value)||e.focus()},blur(){var e;null==(e=T.value)||e.blur()}}),(l,a)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["yc-input-tag",`yc-input-tag-size-${e.unref(N)}`,{"yc-input-tag-no-value":!e.unref(z).length,"yc-input-tag-disabled":e.unref(x),"yc-input-tag-error":l.error,"yc-input-tag-has-suffix":l.$slots.suffix||D.value}]),onMousedown:a[8]||(a[8]=e=>e.preventDefault()),onClick:a[9]||(a[9]=e=>{var l;return null==(l=T.value)?void 0:l.focus()})},[l.$slots.prefix?(e.openBlock(),e.createBlock(e.unref(i),{key:0,class:"yc-input-tag-prefix"},{default:e.withCtx((()=>[e.renderSlot(l.$slots,"prefix",{},void 0,!0)])),_:3})):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"yc-input-tag-mirror",ref_key:"mirrorRef",ref:E},e.toDisplayString(e.unref(I)||(e.unref(z).length?"":l.placeholder)),513),e.createVNode(e.TransitionGroup,{name:"input-tag-zoom",tag:"div",class:"yc-input-tag-inner"},{default:e.withCtx((()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList($.value.visibleList,(a=>e.renderSlot(l.$slots,"tag",{key:null==a?void 0:a[P.value.id],tag:a},(()=>[e.createVNode(e.unref(n),{closable:a[P.value.closable],bordered:a[P.value.tagProps].bordered,nowrap:a[P.value.tagProps].nowrap,checked:!1,onClose:e=>O("close",e,null==a?void 0:a[P.value.id])},{default:e.withCtx((()=>[e.createTextVNode(e.toDisplayString(l.formatTag?l.formatTag(a):a[P.value.label]),1)])),_:2},1032,["closable","bordered","nowrap","onClose"])]),!0))),128)),e.unref(_)>0&&e.unref(z).length>e.unref(_)?(e.openBlock(),e.createBlock(e.unref(n),{nowrap:e.unref(q),checked:!1,bordered:"",key:"yc-select-value-tag"},{default:e.withCtx((()=>[e.createTextVNode(" +"+e.toDisplayString($.value.hideList.length)+"... ",1)])),_:1},8,["nowrap"])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":a[0]||(a[0]=l=>e.isRef(I)?I.value=l:null),key:"yc-input-tag-input",disabled:e.unref(x),readonly:e.unref(w),placeholder:e.unref(z).length?"":l.placeholder,style:e.normalizeStyle({width:e.unref(t.valueToPx)(e.unref(S))}),class:"yc-input-tag-input",ref_key:"inputRef",ref:T,onInput:a[1]||(a[1]=e=>O("input",e)),onChange:a[2]||(a[2]=e=>O("input-value-change",e)),onFocus:a[3]||(a[3]=e=>O("focus",e)),onBlur:a[4]||(a[4]=e=>O("blur",e)),onKeydown:[a[5]||(a[5]=e.withKeys((e=>O("pressEnter",e)),["enter"])),a[6]||(a[6]=e.withKeys((e=>O("remove",e)),["delete"]))]},null,44,d),[[e.vModelText,e.unref(I)]])])),_:3}),l.$slots.suffix||D.value?(e.openBlock(),e.createBlock(e.unref(i),{key:1,class:"yc-input-tag-suffix"},{default:e.withCtx((()=>[D.value?(e.openBlock(),e.createBlock(e.unref(s),{key:0,class:"yc-input-tag-clear-button",onClick:a[7]||(a[7]=e=>O("clear",e))})):e.createCommentVNode("",!0),e.renderSlot(l.$slots,"suffix",{},void 0,!0)])),_:3})):e.createCommentVNode("",!0)],34))}});module.exports=c;
