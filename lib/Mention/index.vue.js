"use strict";const e=require("vue");require("../node_modules/tinycolor2/esm/tinycolor.js"),require("../_shared/utils/dom.js");const l=require("../_shared/utils/is.js");require("../_shared/utils/time.js"),require("../Empty/index.js"),require("../_shared/icons/_Icon.vue.js");const a=require("../_shared/utils/control.js"),u=require("../Input/hooks/useCursor.js"),t=require("../AutoComplete/index.js"),o=e.defineComponent({name:"Mention",__name:"index",props:{modelValue:{default:void 0},defaultValue:{default:""},data:{default:()=>[]},prefix:{default:"@"},split:{default:""},type:{default:"input"},disabled:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!1}},emits:["update:modelValue","change","search","select","focus","blur","clear","input"],setup(o,{expose:r,emit:s}){const n=o,i=s,{modelValue:c,defaultValue:d,allowClear:v,disabled:p,prefix:f,split:m,data:y,type:b}=e.toRefs(n),g=a(c,d.value,(e=>i("update:modelValue",e))),h=e.ref(0),k=e.ref(!1),C=e.ref(),x=e.ref(),V=e.computed((()=>l.isArray(f.value)?f.value.map((e=>y.value.map((l=>e+l.value)))).flat(1):y.value.map((e=>f.value+e.value)))),{recordCursor:_,getCursor:q}=u(x),w=async(a,u)=>{var t;await e.nextTick(),_();const{selectionStart:o}=u.target;if(h.value=q()??o,l.isNull(h.value)||!y.value.length)return;const r=h.value?a[h.value-1]:"";if(k.value=l.isArray(f.value)?f.value.includes(r):f.value==r,!k.value||"textarea"!=b.value)return;const s=C.value.getMirrorRef(),n=document.createRange(),i=s.childNodes[0];n.setStart(i,h.value),n.setEnd(i,h.value);const{bottom:c,left:d}=n.getBoundingClientRect(),{bottom:v}=x.value.getBoundingClientRect();null==(t=C.value)||t.updatePosition(d,c>v?v:c)},j=async(e,l,a="")=>{switch(e){case"input":i("input",a,l),w(a,l);break;case"select":i("select",a),k.value=!1;if(V.value.some((e=>g.value.includes(e)))){const e=g.value.slice(0,h.value-1),l=g.value.slice(h.value-1,h.value),u=g.value.slice(h.value);g.value=e+m.value+l+a+u}else g.value=g.value.slice(0,h.value)+a+g.value.slice(h.value);break;case"focus":i("focus",l);break;case"blur":k.value=!1,i("blur",l);break;case"keydown":{const e=l;if(!["Backspace"].includes(e.key))return;w("Backspace"==e.key?a:g.value,l)}}};return e.onMounted((()=>{var e;x.value=null==(e=C.value)?void 0:e.getInputRef()})),r({focus(){var e;null==(e=x.value)||e.focus()},blur(){var e;null==(e=x.value)||e.blur()}}),(l,a)=>(e.openBlock(),e.createBlock(e.unref(t),e.mergeProps({modelValue:e.unref(g),"onUpdate:modelValue":a[0]||(a[0]=l=>e.isRef(g)?g.value=l:null),popupVisible:k.value,data:e.unref(y),disabled:e.unref(p),"allow-clear":e.unref(v),"is-select-set-value":!1,"is-search":!1,type:l.type,"trigger-props":{autoFitPopupWidth:"input"==l.type,autoSetPosition:"textarea"==l.type},class:"yc-mention",ref_key:"autoCompleteRef",ref:C},l.$attrs,{onInput:a[1]||(a[1]=(e,l)=>j("input",l,e)),onChange:a[2]||(a[2]=e=>l.$emit("change",e)),onSearch:a[3]||(a[3]=e=>l.$emit("search",e)),onClear:a[4]||(a[4]=e=>l.$emit("clear",e)),onSelect:a[5]||(a[5]=e=>j("select",null,e)),onFocus:a[6]||(a[6]=e=>j("focus",e)),onBlur:a[7]||(a[7]=e=>j("blur",e)),onKeydown:a[8]||(a[8]=e=>j("keydown",e))}),e.createSlots({_:2},[l.$slots.option?{name:"option",fn:e.withCtx((({data:a})=>[e.renderSlot(l.$slots,"option",{data:a})])),key:"0"}:void 0]),1040,["modelValue","popupVisible","data","disabled","allow-clear","type","trigger-props"]))}});module.exports=o;
