"use strict";const e=require("vue"),t=require("../../node_modules/nanoid/index.browser.js");require("../../node_modules/tinycolor2/esm/tinycolor.js"),require("../../_shared/utils/dom.js");const r=require("../../_shared/utils/fn.js");require("../../_shared/utils/time.js");const u=require("../../_shared/utils/vue-utils.js");require("../../Empty/index.js"),require("../../_shared/icons/_Icon.vue.js");const o="trigger-context";module.exports=i=>{const{trigger:s,popupRef:a,computedVisible:n,mouseEnterDelay:l}=i,{depth:d,curDepth:p,groupIds:c,timeout:m,hoverTimeout:v}=e.inject(o,{depth:-1,curDepth:e.ref(0),groupIds:e.ref([]),timeout:e.ref(),hoverTimeout:e.ref()}),h=d+1,g=t.nanoid(32);c.value[h]=g,e.provide(o,{depth:h,curDepth:p,groupIds:c,hoverTimeout:v,timeout:m});const f=e=>{const t=e.getAttribute("data-group-id"),r=e.getAttribute("data-group-depth"),u=!!t&&c.value.includes(g);return u||"BODY"==e.tagName?{isGroup:u,groupId:t,depth:u?Number.parseInt(r):-1}:f(e.parentElement)};return e.watch((()=>p.value),(e=>{h<=e||"hover"!=s||(n.value=!1)})),e.watch((()=>n.value),(async e=>{if(!e)return;await r.sleep(0);const t=u.unrefElement(a);null==t||t.setAttribute("data-group-id",g),null==t||t.setAttribute("data-group-depth",`${h}`)}),{immediate:!0}),{timeout:m,mouseEnterHandler:()=>{v.value&&clearTimeout(v.value),v.value=setTimeout((()=>{p.value=h}),l.value)},clickOutsideHandler:e=>{if(c.value.length<=1)return!1;const{isGroup:t,depth:r}=f(e.target??e);return n.value=t?h<=r:n.value,t},mosueLeaveHandler:e=>{if(c.value.length<=1)return!1;const{isGroup:t}=f(e.relatedTarget);return t?n.value=!1:p.value=-1,!0}}};
