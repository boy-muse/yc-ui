"use strict";const t=require("vue"),e=require("../../node_modules/@vueuse/core/index.js");require("../../node_modules/tinycolor2/esm/tinycolor.js"),require("../../_shared/utils/dom.js");const o=require("../../_shared/utils/fn.js");require("../../_shared/utils/time.js");const i=require("../../_shared/utils/vue-utils.js"),l=require("../../_shared/utils/global-config.js");module.exports=u=>{const{props:r,computedVisible:a,popupRef:s,triggerRef:n,arrowRef:p,mouseX:h,mouseY:v}=u,{trigger:g,alignPoint:d,popupTranslate:f,popupOffset:c,autoFitPosition:b,autoFitPopupMinWidth:W,autoFitPopupWidth:m,autoSetPosition:w,showArrow:x,position:H,arrowStyle:T,contentStyle:P}=t.toRefs(r),{updateAtScroll:S,zIndex:q}=l.getGlobalConfig(r),y=t.ref(H.value),{width:j,height:_}=e.useElementSize(s,void 0,{box:"border-box"}),{arrowWidth:z,arrowHeight:E}=function(){if(!x.value)return{arrowWidth:t.ref(0),arrowHeight:t.ref(0)};const{width:o,height:i}=e.useElementSize(p,void 0,{box:"border-box"});return{arrowWidth:o,arrowHeight:i}}(),{left:R,top:I,bottom:L,right:M,width:F,height:A}=e.useElementBounding(n,{windowScroll:S.value,updateTiming:"next-frame"}),B=t.computed((()=>{const[t,e]=G(),i=d.value&&["click","contextMenu"].includes(g.value);if(w.value||i)return{top:o.valueToPx(v.value+e),left:o.valueToPx(h.value-(b.value?0:j.value/2)+t),zIndex:q.value};const[l,u]=O({position:y.value,triggerWidth:F.value,triggerHeight:A.value,popupHeight:_.value,popupWidth:j.value,top:I.value,left:R.value,right:M.value,bottom:L.value});if(!b.value)return{top:o.valueToPx(u+e),left:o.valueToPx(l+t),zIndex:q.value};const[r,a]=V({offsetLeft:l,offsetTop:u,position:y.value,top:I.value,left:R.value,right:M.value,bottom:L.value,popupHeight:_.value,popupWidth:j.value});y.value=function(t){const{offsetLeft:e,offsetTop:o,top:i,left:l,bottom:u,right:r,triggerWidth:a,triggerHeight:s,popupHeight:n,popupWidth:p}=t,h=1e-5,v=[[i-n,l+(a-p)/2,"top"],[i-n,l,"tl"],[i-n,r-p,"tr"],[u,l+(a-p)/2,"bottom"],[u,l,"bl"],[u,r-p,"br"],[i+(s-n)/2,l-p,"left"],[i,l-p,"lt"],[u-n,l-p,"lb"],[i+(s-n)/2,r,"right"],[i,r,"rt"],[u-n,r,"rb"]].find((([t,i])=>Math.abs(i-e)<h&&Math.abs(t-o)<h));return(null==v?void 0:v[2])??y.value}({offsetLeft:r,offsetTop:a,top:I.value,left:R.value,right:M.value,bottom:L.value,triggerWidth:F.value,triggerHeight:A.value,popupHeight:_.value,popupWidth:j.value});const[s,n]=G();return{left:o.valueToPx(r+s),top:o.valueToPx(a+n),zIndex:q.value}})),C=t.computed((()=>({width:m.value?o.valueToPx(F.value):"",minWidth:W.value?o.valueToPx(F.value):"",...P.value}))),k=t.computed((()=>({...T.value,...X({position:y.value,popupWidth:j.value,popupHeight:_.value,arrowWidth:z.value,arrowHeight:E.value,triggerHeight:A.value,triggerWidth:F.value})})));function G(){const[t,e]=f.value;let o=t,i=e;return y.value.startsWith("t")?i=-c.value:y.value.startsWith("b")?i=c.value:y.value.startsWith("l")?o=-c.value:y.value.startsWith("r")&&(o=c.value),[o,i]}const O=t=>{let e=0,o=0;const{position:i,triggerWidth:l,triggerHeight:u,popupWidth:r,popupHeight:a,left:s,top:n,right:p,bottom:h}=t;return["top","tl","tr","bottom","bl","br"].includes(i)?(e=i.startsWith("t")?n-a:h,o=["top","bottom"].includes(i)?s+(l-r)/2:["tl","bl"].includes(i)?s:p-r):(o=i.startsWith("l")?s-r:p,e=["left","right"].includes(i)?n+(u-a)/2:["lt","rt"].includes(i)?n:h-a),[o,e]},V=t=>{const{position:e,offsetLeft:o,offsetTop:i,bottom:l,left:u,right:r,top:a,popupHeight:s,popupWidth:n}=t;let p=o,h=i;return["top","tl","tr","bottom","bl","br"].includes(e)?(i<0&&["top","tl","tr"].includes(e)?h=l:i+s>window.innerHeight&&["bottom","bl","br"].includes(e)&&(h=a-s),o<0?p=u:o+n>window.innerWidth&&(p=r-n)):(o<0&&["left","lt","lb"].includes(e)?p=r:o+n>window.innerWidth&&["right","rt","rb"].includes(e)&&(p=u-n),i<0?h=a:h+s>window.innerHeight&&(h=a-s)),[p,h]};const X=t=>{const{position:e,triggerWidth:i,triggerHeight:l,popupWidth:u,popupHeight:r,arrowHeight:a,arrowWidth:s}=t;let n;if(["top","tl","tr","bottom","bl","br"].includes(e)){let t="",l="";["top","bottom"].includes(e)?t=o.valueToPx((u-s)/2):["tl","bl"].includes(e)?t=o.valueToPx((i-s)/2):l=o.valueToPx((i-s)/2),n={top:e.startsWith("b")?"0":"",right:l,bottom:e.startsWith("t")?"0":"",left:t}}else{let t="",i="";["left","right"].includes(e)?t=o.valueToPx((r-a)/2):["lt","rt"].includes(e)?t=o.valueToPx((l-a)/2):i=o.valueToPx((l-a)/2),n={top:t,right:e.startsWith("l")?"0":"",bottom:i,left:e.startsWith("r")?"0":""}}return n};return t.watch((()=>a.value),(async t=>{if(!t)return;await o.sleep(0),y.value=H.value;const e=i.unrefElement(n),l=i.unrefElement(s);if(e){const{left:t,right:o,top:i,bottom:l,width:u,height:r}=e.getBoundingClientRect();R.value=t,M.value=o,I.value=i,L.value=l,F.value=u,A.value=r}if(l){const{offsetWidth:t,offsetHeight:e}=l;j.value=t,_.value=e}if(p.value){const{offsetWidth:t,offsetHeight:e}=p.value;z.value=t,E.value=e}})),{position:y,left:R,top:I,bottom:L,right:M,popupWidth:j,popupHeight:_,triggerWidth:F,triggerHeight:A,arrowWidth:z,arrowHeight:E,popupStyle:B,contentStyle:C,arrowStyle:k}};
