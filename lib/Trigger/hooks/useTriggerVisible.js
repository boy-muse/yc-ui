"use strict";const e=require("vue"),l=require("../../node_modules/@vueuse/core/index.js"),u=require("./useContext.js");require("../../node_modules/tinycolor2/esm/tinycolor.js");const a=require("../../_shared/utils/dom.js");require("../../_shared/utils/time.js");const o=require("../../_shared/utils/vue-utils.js"),s=require("../../_shared/utils/global-config.js"),r=require("../../_shared/utils/control.js");module.exports=i=>{const{props:t,emits:v,popupRef:n,triggerRef:c}=i,{trigger:d,popupVisible:p,defaultPopupVisible:m,clickToClose:g,blurToClose:T,clickOutsideToClose:f,mouseEnterDelay:h,mouseLeaveDelay:b,focusDelay:k,disabled:C,scrollToCloseDistance:q,autoSetPosition:j,alignPoint:y}=e.toRefs(t),{scrollToClose:M}=s.getGlobalConfig(t),{onTriggerMouseclick:_,onTriggerMouseenter:x,onTriggerMouseleave:E,onTriggerBlur:D,onTriggerFocus:L,onClickOutSide:V}=t,O=r(p,m.value,(e=>{v("update:popupVisible",e),v("popup-visible-change",e)})),{timeout:P,mosueLeaveHandler:R,mouseEnterHandler:w,clickOutsideHandler:F}=u({trigger:d.value,mouseEnterDelay:h,computedVisible:O,popupRef:n}),H=e.ref(0),S=e.ref(0);let B=0,X=0;const Y=e.computed((()=>c.value?a.findFirstScrollableParent(o.unrefElement(c.value)):null));return e.watch((()=>O.value),(async()=>{if(await e.nextTick(),!Y.value)return;const{scrollTop:l,scrollLeft:u}=Y.value;B=u,X=l})),f.value&&["click","contextMenu"].includes(d.value)&&l.onClickOutside(n,(e=>{if(C.value)return;const l=F(e);O.value&&!l&&(O.value=!1,null==V||V())}),{ignore:[c]}),(async()=>{await e.nextTick(),M.value&&Y.value&&l.useEventListener(Y,"scroll",(()=>{if(!O.value)return;const{scrollTop:e,scrollLeft:l}=Y.value;(Math.abs(e-X)>=q.value||Math.abs(l-B)>=q.value)&&(O.value=!1,X=e)}))})(),{mouseX:H,mouseY:S,computedVisible:O,handleClickEvent:(e,l)=>{if(d.value==l&&!C.value){if(P.value&&clearTimeout(P.value),!j.value&&y.value){const{pageX:l,pageY:u}=e;H.value=l,S.value=u}O.value=!g.value||!O.value,null==_||_()}},handleMouseenter:()=>{"hover"!=d.value||C.value||(w(),P.value&&clearTimeout(P.value),O.value||(P.value=setTimeout((()=>{O.value=!0,null==x||x()}),h.value)))},handleMouseleave:e=>{"hover"!=d.value||C.value||(P.value&&clearTimeout(P.value),O.value&&(P.value=setTimeout((()=>{null==E||E();R(e)||(O.value=!1)}),b.value)))},handleFocus:()=>{"focus"!=d.value||C.value||(P.value&&clearTimeout(P.value),O.value||(P.value=setTimeout((()=>{O.value=!0,null==L||L()}),k.value)))},handleBlur:()=>{"focus"==d.value&&T.value&&!C.value&&(P.value&&clearTimeout(P.value),O.value&&(O.value=!1,null==D||D()))}}};
